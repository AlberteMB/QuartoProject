# Dynamo DB

## ğŸ“Œ Â¿QuÃ© es DynamoDB?

**Amazon DynamoDB** es una base de datos NoSQL completamente gestionada por AWS. EstÃ¡ diseÃ±ada para aplicaciones que requieren baja latencia y alta escalabilidad, ideal para cargas de trabajo como catÃ¡logos de productos, juegos en tiempo real, IoT o cualquier aplicaciÃ³n web moderna.

---

## ğŸ§  CaracterÃ­sticas clave

- ğŸ”„ **Totalmente gestionada:** No necesitas administrar servidores ni almacenamiento.
- âš¡ **Baja latencia:** Respuestas rÃ¡pidas en milisegundos.
- ğŸš€ **Escalabilidad automÃ¡tica:** Se adapta al volumen de datos y trÃ¡fico.
- ğŸ’¾ **Flexible:** No requiere esquemas fijos; ideal para datos semiestructurados.
- ğŸ›¡ï¸ **Alta disponibilidad:** ReplicaciÃ³n automÃ¡tica en mÃºltiples zonas de disponibilidad.
- ğŸ” **Seguridad:** IntegraciÃ³n con IAM, cifrado en reposo y en trÃ¡nsito.

---

## ğŸ§± Estructura bÃ¡sica de DynamoDB

| Componente         | DescripciÃ³n |
|--------------------|-------------|
| **Tabla**          | AgrupaciÃ³n de Ã­tems (como una tabla SQL, pero sin columnas fijas). |
| **Ãtem (Item)**    | Equivalente a una fila en SQL. Cada Ã­tem es un objeto JSON. |
| **Atributo**       | Equivalente a una columna, pero no necesitas que todos los Ã­tems tengan los mismos atributos. |
| **Clave primaria** | Necesaria para identificar Ã­tems de forma Ãºnica. Puede ser: |
| - Clave de particiÃ³n (**hash key**) |
| - Clave de particiÃ³n + clave de ordenaciÃ³n (**range key**) |

---

## ğŸ” Modelo de datos

```json
{
  "userId": "123",
  "movieId": "456",
  "rating": 5,
  "watched": true,
  "tags": ["thriller", "2020s"]
}
```

- En este ejemplo, `userId` podrÃ­a ser la **partition key** y `movieId` la **sort key**.

---

## ğŸ› ï¸ Operaciones comunes (API)

| AcciÃ³n       | DescripciÃ³n |
|--------------|-------------|
| `PutItem`    | Inserta o reemplaza un Ã­tem. |
| `GetItem`    | Recupera un Ã­tem por su clave primaria. |
| `UpdateItem` | Modifica atributos especÃ­ficos de un Ã­tem. |
| `DeleteItem` | Elimina un Ã­tem. |
| `Query`      | Consulta Ã­tems por clave de particiÃ³n y sort key. |
| `Scan`       | Lee todos los Ã­tems de una tabla (costosa, Ãºsala con cuidado). |

---

## âš™ï¸ Tipos de Ã­ndices

- ğŸ”‘ **Ãndice global secundario (GSI):** Te permite consultar usando otros atributos como claves.
- ğŸ”‚ **Ãndice local secundario (LSI):** Usa la misma partition key pero distinta sort key.

---

## ğŸ“ Buenas prÃ¡cticas

1. **Modela segÃºn patrones de acceso**, no como una base de datos relacional.
2. Usa `Query` en lugar de `Scan` siempre que sea posible.
3. Limita el uso de GSIs innecesarios.
4. Aprovecha la consistencia eventual o fuerte segÃºn lo necesites.
5. Usa **provisionamiento automÃ¡tico** o **modo on-demand** segÃºn tu caso.

---

## ğŸš€ Desplegar con AWS CLI

```bash
aws dynamodb create-table \
  --table-name Movies \
  --attribute-definitions AttributeName=movieId,AttributeType=S \
  --key-schema AttributeName=movieId,KeyType=HASH \
  --billing-mode PAYPERREQUEST \
  --region eu-west-1
```

---

## ğŸ“‚ Cargar datos desde Bash

```bash
aws dynamodb put-item \
  --table-name Movies \
  --item file://movie.json \
  --region eu-west-1
```

Ejemplo de `movie.json`:

```json
{
  "movieId": {"S": "001"},
  "title": {"S": "Inception"},
  "year": {"N": "2010"},
  "genres": {"SS": ["Sci-Fi", "Thriller"]}
}
```

---

## ğŸ“š Recursos Ãºtiles

- [DocumentaciÃ³n oficial](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Introduction.html)
- [Patrones de diseÃ±o DynamoDB](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-general-nosql-design.html)
- [Modelado NoSQL en DynamoDB](https://www.youtube.com/watch?v=HaEPXoXVf2k)


## Config de Dynamo DB en Vaadin.
- Dependencia SDK, config y credenciales.

# Flujo de datos desde TypeScript hasta DynamoDB

```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ .tsx (React) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Objeto literal (JS) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ JSON.stringify
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JSON (Texto) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ (Enviado vÃ­a Web Service)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Java: Map<String, Object>  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Mapper
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Java: Map<String, AttributeValue> â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ putItem (AWS SDK)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DynamoDB Item                                â”‚
â”‚ {                                            â”‚
â”‚   "clave": { "S": "valor" },                 â”‚
â”‚   "numero": { "N": "123" },                  â”‚
â”‚   ...                                        â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
---

## Ejemplo de mÃ©todo para filtrar por platform y genre.
```java
@Override
public List<Movie> findByPlatformAndGenre(String platform, Movie.Genre genre) {
    Key key = Key.builder().partitionValue(platform).build();

    QueryConditional queryConditional = QueryConditional.keyEqualTo(key);

    List<Movie> results = new ArrayList<>();

    SdkIterable<Page<Movie>> pages = movieTable.query(r -> r.queryConditional(queryConditional));

    for (Page<Movie> page : pages) {
        for (Movie movie : page.items()) {
            if (movie.getGenres().contains(genre)) {
                results.add(movie);
            }
        }
    }

    return results;
}
```

### Key construction:
```java
// Using "platform" as Partition Key in my project
Key key = Key.builder().partitionValue(platform).build();
```
- **Key:** Una clase especÃ­fica de DynamoDB Enhanced Client para representar una PK o SK.
- **Key.Builder():** Comienza a construir una clave.
- **.partitionValue(platform):** Le pasamos la PK.
- **.build():** Termina de construir la Key.

---

### QueryConditional Class
- Es una clase que define la condiciÃ³n bajo la cual DynamoDB va a buscar elementos.
       Ejemplos:
       - "Quiero los elementos con esta PK"
       - "Quiero los elementos con esta PK y un SK mayor que X"

- **keyEqualTo(key):** Define una condiciÃ³n. ("Dame todos los Ã­tems cuya PK sea igual a `plataform`")  

```java
QueryConditional queryConditional = QueryConditional.keyEqualTo(key);
```

---

### SdkIterable
```java
SdkIterable<Page<Movie>> pages = movieTable.query(r -> r.queryConditional(queryConditional));
```

- **SdkIterable<Page<Movie>>:** Estructura que representa las pÃ¡ginas de resultados que devuelve DynamoDB. DynamoDB no suele dar todos los resultados de golpe, por eso iteramos con `Page`.

- **movieTable.query(...):** Hacemos una consulta a la tabla usando la condiciÃ³n anterior.

### Recorremos las pÃ¡ginas y filtramos por gÃ©nero.
```java
for (Page<Movie> page : pages) {
    for (Movie movie : page.items()) {
        if (movie.getGenres().contains(genre)) {
            results.add(movie);
        }
    }
}
```
- Recorremos todas las pÃ¡ginas (*for (Page<Movie> page : pages)*)

- Luego recorremos los Ã­tems dentro de cada pÃ¡gina (page.items())

- Y filtramos solo las pelÃ­culas que tienen ese gÃ©nero en su lista de gÃ©neros (movie.getGenres().contains(genre))

---

## DynamoDbTable class
- En el repositorio:

```java
private final DynamoDbTable<Movie> movieTable;

@Autowired
public MovieRepositoryImpl(DynamoDbEnhancedClient enhancedClient) {
    this.enhancedClient = enhancedClient;
    this.movieTable = enhancedClient.table(tableName, TableSchema.fromBean(Movie.class));
}
```
- **enhancedClient.table(...)** le dice al cliente que quieres trabajar con una tabla de DynamoDB.

- Le pasas:

       El nombre de la tabla ("Movies")

       El esquema de mapeo de tu clase Movie (TableSchema.fromBean(Movie.class)), que usa las anotaciones como @DynamoDbPartitionKey, @DynamoDbAttribute, etc.




